import{aO as e,aP as t,aQ as s,o as a,c as i,w as o,H as n,s as r,v as l,h as c,k as d,r as p,a as m,aM as u,b as h,aL as f,d as v,B as g,m as k,aJ as b,n as y,e as _,f as P,F as C,t as S,l as w,aR as D,q as I,aS as T,aT as x,p as L,aI as $,C as M,aK as Y,g as A}from"./index.11096ec6.js";import{b as j,d as B,u as z,_ as H,a as V}from"./bookingDatesService.4a915d23.js";import{_ as N}from"./tabbar.vue_vue_type_script_setup_true_lang.c61322ac.js";import{_ as E}from"./u-avatar.1007c5ff.js";import{_ as O}from"./_plugin-vue_export-helper.cdc0426e.js";import{l as R}from"./lodash.default.25203653.js";import{_ as X,a as U}from"./u-form-item.17230b1b.js";import{a as W}from"./appService.129bd686.js";import{_ as q}from"./u-form.429fcf87.js";import{P as Z}from"./popup-modal.8582d6e1.js";import{g as F}from"./util.9e38efcf.js";import"./u-icon.5ed808e6.js";class K{constructor(t,s){this.options=t,this.animation=e(t),this.currentStepAnimates={},this.next=0,this.$=s}_nvuePushAnimates(e,t){let s=this.currentStepAnimates[this.next],a={};if(a=s||{styles:{},config:{}},J.includes(e)){a.styles.transform||(a.styles.transform="");let s="";"rotate"===e&&(s="deg"),a.styles.transform+=`${e}(${t+s}) `}else a.styles[e]=`${t}`;this.currentStepAnimates[this.next]=a}_animateRun(e={},t={}){let s=this.$.$refs.ani.ref;if(s)return new Promise(((a,i)=>{nvueAnimation.transition(s,{styles:e,...t},(e=>{a()}))}))}_nvueNextAnimate(e,t=0,s){let a=e[t];if(a){let{styles:i,config:o}=a;this._animateRun(i,o).then((()=>{t+=1,this._nvueNextAnimate(e,t,s)}))}else this.currentStepAnimates={},"function"==typeof s&&s(),this.isEnd=!0}step(e={}){return this.animation.step(e),this}run(e){this.$.animationData=this.animation.export(),this.$.timer=setTimeout((()=>{"function"==typeof e&&e()}),this.$.durationTime)}}const J=["matrix","matrix3d","rotate","rotate3d","rotateX","rotateY","rotateZ","scale","scale3d","scaleX","scaleY","scaleZ","skew","skewX","skewY","translate","translate3d","translateX","translateY","translateZ"];function Q(e,t){if(t)return clearTimeout(t.timer),new K(e,t)}J.concat(["opacity","backgroundColor"],["width","height","left","right","top","bottom"]).forEach((e=>{K.prototype[e]=function(...t){return this.animation[e](...t),this}}));const G=O({name:"uniTransition",emits:["click","change"],props:{show:{type:Boolean,default:!1},modeClass:{type:[Array,String],default:()=>"fade"},duration:{type:Number,default:300},styles:{type:Object,default:()=>({})},customClass:{type:String,default:""},onceRender:{type:Boolean,default:!1}},data:()=>({isShow:!1,transform:"",opacity:1,animationData:{},durationTime:300,config:{}}),watch:{show:{handler(e){e?this.open():this.isShow&&this.close()},immediate:!0}},computed:{stylesObject(){let e={...this.styles,"transition-duration":this.duration/1e3+"s"},t="";for(let s in e){t+=this.toLine(s)+":"+e[s]+";"}return t},transformStyles(){return"transform:"+this.transform+";opacity:"+this.opacity+";"+this.stylesObject}},created(){this.config={duration:this.duration,timingFunction:"ease",transformOrigin:"50% 50%",delay:0},this.durationTime=this.duration},methods:{init(e={}){e.duration&&(this.durationTime=e.duration),this.animation=Q(Object.assign(this.config,e),this)},onClick(){this.$emit("click",{detail:this.isShow})},step(e,t={}){if(this.animation){for(let t in e)try{"object"==typeof e[t]?this.animation[t](...e[t]):this.animation[t](e[t])}catch(s){console.error(`方法 ${t} 不存在`)}return this.animation.step(t),this}},run(e){this.animation&&this.animation.run(e)},open(){clearTimeout(this.timer),this.transform="",this.isShow=!0;let{opacity:e,transform:t}=this.styleInit(!1);void 0!==e&&(this.opacity=e),this.transform=t,this.$nextTick((()=>{this.timer=setTimeout((()=>{this.animation=Q(this.config,this),this.tranfromInit(!1).step(),this.animation.run(),this.$emit("change",{detail:this.isShow})}),20)}))},close(e){this.animation&&this.tranfromInit(!0).step().run((()=>{this.isShow=!1,this.animationData=null,this.animation=null;let{opacity:e,transform:t}=this.styleInit(!1);this.opacity=e||1,this.transform=t,this.$emit("change",{detail:this.isShow})}))},styleInit(e){let t={transform:""},s=(e,s)=>{"fade"===s?t.opacity=this.animationType(e)[s]:t.transform+=this.animationType(e)[s]+" "};return"string"==typeof this.modeClass?s(e,this.modeClass):this.modeClass.forEach((t=>{s(e,t)})),t},tranfromInit(e){let t=(e,t)=>{let s=null;"fade"===t?s=e?0:1:(s=e?"-100%":"0","zoom-in"===t&&(s=e?.8:1),"zoom-out"===t&&(s=e?1.2:1),"slide-right"===t&&(s=e?"100%":"0"),"slide-bottom"===t&&(s=e?"100%":"0")),this.animation[this.animationMode()[t]](s)};return"string"==typeof this.modeClass?t(e,this.modeClass):this.modeClass.forEach((s=>{t(e,s)})),this.animation},animationType:e=>({fade:e?1:0,"slide-top":`translateY(${e?"0":"-100%"})`,"slide-right":`translateX(${e?"0":"100%"})`,"slide-bottom":`translateY(${e?"0":"100%"})`,"slide-left":`translateX(${e?"0":"-100%"})`,"zoom-in":`scaleX(${e?1:.8}) scaleY(${e?1:.8})`,"zoom-out":`scaleX(${e?1:1.2}) scaleY(${e?1:1.2})`}),animationMode:()=>({fade:"opacity","slide-top":"translateY","slide-right":"translateX","slide-bottom":"translateY","slide-left":"translateX","zoom-in":"scale","zoom-out":"scale"}),toLine:e=>e.replace(/([A-Z])/g,"-$1").toLowerCase()}},[["render",function(e,p,m,u,h,f){const v=d;return h.isShow||m.onceRender?t((a(),i(v,{key:0,ref:"ani",animation:h.animationData,class:r(m.customClass),style:l(f.transformStyles),onClick:f.onClick},{default:o((()=>[n(e.$slots,"default")])),_:3},8,["animation","class","style","onClick"])),[[s,h.isShow]]):c("v-if",!0)}]]);const ee=O({name:"uniPopup",components:{keypress:{name:"Keypress",props:{disable:{type:Boolean,default:!1}},mounted(){const e={esc:["Esc","Escape"],tab:"Tab",enter:"Enter",space:[" ","Spacebar"],up:["Up","ArrowUp"],left:["Left","ArrowLeft"],right:["Right","ArrowRight"],down:["Down","ArrowDown"],delete:["Backspace","Delete","Del"]};document.addEventListener("keyup",(t=>{if(this.disable)return;const s=Object.keys(e).find((s=>{const a=t.key,i=e[s];return i===a||Array.isArray(i)&&i.includes(a)}));s&&setTimeout((()=>{this.$emit(s,{})}),0)}))},render:()=>{}}},emits:["change","maskClick"],props:{animation:{type:Boolean,default:!0},type:{type:String,default:"center"},isMaskClick:{type:Boolean,default:null},maskClick:{type:Boolean,default:null},backgroundColor:{type:String,default:"none"},safeArea:{type:Boolean,default:!0},maskBackgroundColor:{type:String,default:"rgba(0, 0, 0, 0.4)"},onceRender:{type:Boolean,default:!1}},watch:{type:{handler:function(e){this.config[e]&&this[this.config[e]](!0)},immediate:!0},isDesktop:{handler:function(e){this.config[e]&&this[this.config[this.type]](!0)},immediate:!0},maskClick:{handler:function(e){this.mkclick=e},immediate:!0},isMaskClick:{handler:function(e){this.mkclick=e},immediate:!0},showPopup(e){document.getElementsByTagName("body")[0].style.overflow=e?"hidden":"visible"}},data(){return{duration:300,ani:[],showPopup:!1,showTrans:!1,popupWidth:0,popupHeight:0,config:{top:"top",bottom:"bottom",center:"center",left:"left",right:"right",message:"top",dialog:"center",share:"bottom"},maskClass:{position:"fixed",bottom:0,top:0,left:0,right:0,backgroundColor:"rgba(0, 0, 0, 0.4)"},transClass:{position:"fixed",left:0,right:0},maskShow:!0,mkclick:!0,popupstyle:this.isDesktop?"fixforpc-top":"top"}},computed:{isDesktop(){return this.popupWidth>=500&&this.popupHeight>=500},bg(){return""===this.backgroundColor||"none"===this.backgroundColor?"transparent":this.backgroundColor}},mounted(){(()=>{const{windowWidth:e,windowHeight:t,windowTop:s,safeArea:a,screenHeight:i,safeAreaInsets:o}=f();this.popupWidth=e,this.popupHeight=t+(s||0),a&&this.safeArea?this.safeAreaInsets=o.bottom:this.safeAreaInsets=0})()},unmounted(){this.setH5Visible()},created(){null===this.isMaskClick&&null===this.maskClick?this.mkclick=!0:this.mkclick=null!==this.isMaskClick?this.isMaskClick:this.maskClick,this.animation?this.duration=300:this.duration=0,this.messageChild=null,this.clearPropagation=!1,this.maskClass.backgroundColor=this.maskBackgroundColor},methods:{setH5Visible(){document.getElementsByTagName("body")[0].style.overflow="visible"},closeMask(){this.maskShow=!1},disableMask(){this.mkclick=!1},clear(e){e.stopPropagation(),this.clearPropagation=!0},open(e){this.showPopup&&(clearTimeout(this.timer),this.showPopup=!1);e&&-1!==["top","center","bottom","left","right","message","dialog","share"].indexOf(e)||(e=this.type),this.config[e]?(this[this.config[e]](),this.$emit("change",{show:!0,type:e})):console.error("缺少类型：",e)},close(e){this.showTrans=!1,this.$emit("change",{show:!1,type:this.type}),clearTimeout(this.timer),this.timer=setTimeout((()=>{this.showPopup=!1}),300)},touchstart(){this.clearPropagation=!1},onTap(){this.clearPropagation?this.clearPropagation=!1:(this.$emit("maskClick"),this.mkclick&&this.close())},top(e){this.popupstyle=this.isDesktop?"fixforpc-top":"top",this.ani=["slide-top"],this.transClass={position:"fixed",left:0,right:0,backgroundColor:this.bg},e||(this.showPopup=!0,this.showTrans=!0,this.$nextTick((()=>{this.messageChild&&"message"===this.type&&this.messageChild.timerClose()})))},bottom(e){this.popupstyle="bottom",this.ani=["slide-bottom"],this.transClass={position:"fixed",left:0,right:0,bottom:0,paddingBottom:this.safeAreaInsets+"px",backgroundColor:this.bg},e||(this.showPopup=!0,this.showTrans=!0)},center(e){this.popupstyle="center",this.ani=["zoom-out","fade"],this.transClass={position:"fixed",display:"flex",flexDirection:"column",bottom:0,left:0,right:0,top:0,justifyContent:"center",alignItems:"center"},e||(this.showPopup=!0,this.showTrans=!0)},left(e){this.popupstyle="left",this.ani=["slide-left"],this.transClass={position:"fixed",left:0,bottom:0,top:0,backgroundColor:this.bg,display:"flex",flexDirection:"column"},e||(this.showPopup=!0,this.showTrans=!0)},right(e){this.popupstyle="right",this.ani=["slide-right"],this.transClass={position:"fixed",bottom:0,right:0,top:0,backgroundColor:this.bg,display:"flex",flexDirection:"column"},e||(this.showPopup=!0,this.showTrans=!0)}}},[["render",function(e,f,v,g,k,b){const y=p(m("uni-transition"),G),_=d,P=u("keypress");return k.showPopup||v.onceRender?t((a(),i(_,{key:0,class:r(["uni-popup",[k.popupstyle,b.isDesktop?"fixforpc-z-index":""]])},{default:o((()=>[h(_,{onTouchstart:b.touchstart},{default:o((()=>[k.maskShow?(a(),i(y,{key:"1",name:"mask","mode-class":"fade",styles:k.maskClass,duration:k.duration,show:k.showTrans,onClick:b.onTap},null,8,["styles","duration","show","onClick"])):c("v-if",!0),h(y,{key:"2","mode-class":k.ani,name:"content",styles:k.transClass,duration:k.duration,show:k.showTrans,onClick:b.onTap,"once-render":v.onceRender},{default:o((()=>[h(_,{class:r(["uni-popup__wrapper",[k.popupstyle]]),style:l({backgroundColor:b.bg}),onClick:b.clear},{default:o((()=>[n(e.$slots,"default",{},void 0,!0)])),_:3},8,["style","class","onClick"])])),_:3},8,["mode-class","styles","duration","show","onClick","once-render"])])),_:3},8,["onTouchstart"]),k.maskShow?(a(),i(P,{key:0,onEsc:b.onTap},null,8,["onEsc"])):c("v-if",!0)])),_:3},8,["class"])),[[s,k.showPopup]]):c("v-if",!0)}],["__scopeId","data-v-affa6698"]]),te=O(v({__name:"booking_section",props:{servicePersonId:{default:""},selectedDate:{default:""},section:{default:"am"}},emits:["pickStampToConfirmPage"],setup(e,{expose:t,emit:s}){const n=e;g(null);let l={};const p=k({dataLoaded:!1,hasNightService:!1,pickDate:"",activeTabCode:n.section||"am",datesList:[],personData:{},sectionTabItems:[]}),{days:m,startDate:u,endDate:h}=j.loopDates();p.datesList=m;const f=(e,t="HH:mm")=>B(e).format(t),v=(e=[])=>{const t=(e=>{p.hasNightService=!1;const t={};return e.map((e=>{const s=B(e).format("YYYY-MM-DD"),a=parseInt(B(e).format("H"));t[s]=t[s]||{am:[],pm1:[],pm2:[]},0<=a&&a<=12?t[s].am.push(e):12<a&&a<=18?t[s].pm1.push(e):18<a&&a<=23&&(t[s].pm2.push(e),p.hasNightService=!0)})),t})(e);p.datesList.map((e=>{e.availableStamps=t[e.date]||{am:[],pm1:[],pm2:[]}}))},w=async()=>{p.dataLoaded=!1,l={};let e=[];let t=n.selectedDate;n.selectedDate+""===B().format("YYYY-MM-DD")&&(t="");const s=await j.getAvailableServicePersonsList(1,t,n.servicePersonId)||{};s.servicePerson&&(p.personData=s.servicePerson,e=R.map(s.serviceTimeStamps,"service_time")||[],(s.serviceTimeStamps||[]).map((e=>{l[e.service_time]=e.service_schedule_setting_id}))),v(e),(()=>{const e=[{code:"am",name:"上午"},{code:"pm1",name:"下午"},{code:"pm2",name:"晚上"}],t=n.selectedDate,s=(p.datesList.find((e=>e.date+""==t+""))||{}).availableStamps;e.map((e=>{e.stampList=s[e.code]||[]})),p.sectionTabItems=e})(),p.dataLoaded=!0};return b((e=>{w()})),t({}),(e,t)=>{const n=d;return a(),i(n,null,{default:o((()=>[y("div",{class:"section-stamps rounded-box1"},[y("div",{class:"tab-items"},[(a(!0),_(C,null,P(p.sectionTabItems,((e,t)=>(a(),_(C,null,[e.stampList.length?(a(),_("div",{key:0,class:r(["tab-item",{tab_active:e.code==p.activeTabCode}]),onClick:t=>(e=>{p.activeTabCode=e.code})(e)},[y("div",null,S(e.name),1)],10,["onClick"])):c("v-if",!0)],64)))),256))]),y("div",{class:"stamp-list-wrap"},[y("div",{class:"stamps-list"},[(a(!0),_(C,null,P(p.sectionTabItems,((e,t)=>(a(),_(C,null,[e.code==p.activeTabCode?(a(!0),_(C,{key:0},P(e.stampList,((e,t)=>(a(),_("div",{class:"stamp-item",onClick:t=>((e="")=>{if(!e)return!1;j.pagesParameterBridge("pickStampToConfirmPage",{service_schedule_setting_id:l[e]||"",servicePersonId:p.personData.id||"",service_time:e},"set"),s("pickStampToConfirmPage")})(e),key:t},[y("div",{class:"stamp-time"},S(f(e)),1)],8,["onClick"])))),128)):c("v-if",!0)],64)))),256))])])])])),_:1})}}}),[["__scopeId","data-v-519c5fd6"]]),se=O(v({__name:"booking_person",props:{servicePersonId:{default:""}},emits:["pickOneServiceStamp","pickStampToConfirmPage"],setup(e,{expose:t,emit:s}){const n=e,l=g(null),u=g(null),f=k({dataLoaded:!1,hasNightService:!1,pickDateItem:{servicePersonId:"",selectedDate:"",section:""},datesList:[],personData:{}}),{days:v,startDate:D,endDate:I}=j.loopDates();f.datesList=v;const T=()=>{s("pickStampToConfirmPage")},x=(e=[],t="",s="am")=>{var a;if(!e.length)return!1;f.pickDateItem.servicePersonId=f.personData.id,f.pickDateItem.selectedDate=t,f.pickDateItem.section=s,null==(a=u.value)||a.open()},L=(e,t="MM.DD")=>B(e).format(t),$=(e=[])=>{const t=(e=>{f.hasNightService=!1;const t={};return e.map((e=>{const s=B(e).format("YYYY-MM-DD"),a=parseInt(B(e).format("H"));t[s]=t[s]||{am:[],pm1:[],pm2:[]},0<=a&&a<=12?t[s].am.push(e):12<a&&a<=18?t[s].pm1.push(e):18<a&&a<=23&&(t[s].pm2.push(e),f.hasNightService=!0)})),t})(e);console.log("----",t),f.datesList.map((e=>{e.availableStamps=t[e.date]||{am:[],pm1:[],pm2:[]}}))};return b((e=>{(async()=>{f.dataLoaded=!1;let e=[];const t=await j.getAvailableServicePersonsList(13,"",n.servicePersonId)||{};t.servicePerson&&(f.personData=t.servicePerson,e=R.map(t.serviceTimeStamps,"service_time")||[]),$(e),console.log(f.datesList,"====="),f.dataLoaded=!0})()})),t({}),(e,t)=>{const s=p(m("u-avatar"),E),n=p(m("uni-popup"),ee),v=d;return a(),i(v,null,{default:o((()=>[y("div",{class:"person-info rounded-box1"},[y("div",{class:"header-info"},[y("div",{class:"person-avatar"},[h(s,{src:f.personData.avatar||"/static/images/user/default_avatar.png",size:130},null,8,["src"])]),y("div",{onClick:t[0]||(t[0]=e=>{var t;null==(t=l.value)||t.open()}),class:"person-more-intro"}," 更多介绍 ")]),y("div",{class:"intro-info"},[y("div",{class:"person-name"},S(f.personData.name),1),y("div",{class:"person-brief-intro"},S(f.personData.brief_intro),1)])]),y("div",{class:"person-booking rounded-box1"},[y("div",{class:"booking-sub-title"},"预约"),y("div",null,[f.dataLoaded?(a(),_("div",{key:0,class:"dates-list-items"},[y("div",{class:"first-column"},[y("div",{class:"booking-cell"}),y("div",{class:"booking-cell"},"上午"),y("div",{class:"booking-cell"},"下午"),f.hasNightService?(a(),_("div",{key:0,class:"booking-cell"},"晚上")):c("v-if",!0)]),y("div",{class:"rest-columns"},[(a(!0),_(C,null,P(f.datesList,((e,t)=>(a(),_("div",{class:"date-item-column",key:t},[c("周几"),y("div",{class:"booking-cell weekday-cn"},[y("div",null,S(e.weekdayCn),1),y("div",{style:{"font-weight":"bold"}},S(L(e.date)),1)]),c("上午"),y("div",{class:r(["booking-cell cell-stamp",{bookable_cell:e.availableStamps.am.length}]),onClick:t=>x(e.availableStamps.am,e.date,"am")},[e.availableStamps.am.length?(a(),_("div",{key:0},[w("点击"),y("br"),w("预约")])):c("v-if",!0)],10,["onClick"]),c("下午"),y("div",{class:r(["booking-cell cell-stamp",{bookable_cell:e.availableStamps.pm1.length}]),onClick:t=>x(e.availableStamps.pm1,e.date,"pm1")},[e.availableStamps.pm1.length?(a(),_("div",{key:0},[w("点击"),y("br"),w("预约")])):c("v-if",!0)],10,["onClick"]),c("晚上"),f.hasNightService?(a(),_("div",{key:0,class:r(["booking-cell cell-stamp",{bookable_cell:e.availableStamps.pm2.length}]),onClick:t=>x(e.availableStamps.pm2,e.date,"pm2")},[e.availableStamps.pm2.length?(a(),_("div",{key:0},[w("点击"),y("br"),w("预约")])):c("v-if",!0)],10,["onClick"])):c("v-if",!0)])))),128))])])):c("v-if",!0)])]),h(n,{ref_key:"refDetailPopup",ref:l,type:"bottom","background-color":"#fff"},{default:o((()=>[y("div",{class:"detail-popup"},[y("div",{class:"detail-title"},"详细介绍"),y("div",{class:"detail-content",innerHTML:f.personData.introduction},null,8,["innerHTML"])])])),_:1},512),h(n,{ref_key:"refSelectTimeStampPopup",ref:u,type:"bottom","background-color":"#fff"},{default:o((()=>[y("div",{class:"select-time-stamp-popup"},[y("div",{class:"select-title"},"请选择预约时间， "+S(f.pickDateItem.selectedDate),1),h(te,{servicePersonId:f.pickDateItem.servicePersonId,selectedDate:f.pickDateItem.selectedDate,section:f.pickDateItem.section,onPickStampToConfirmPage:T},null,8,["servicePersonId","selectedDate","section"])])])),_:1},512)])),_:1})}}}),[["__scopeId","data-v-447882e0"]]),ae=O(v({__name:"served_person_manage",emits:["saveServedPeron","close","finishSelect"],setup(e,{expose:t,emit:s}){const n=g(null);g(null);const r=k({real_name:{required:!0,errorMessage:"请输入注册手机号码"}}),l=k({id:"",real_name:"",booking_user_id:z.getUserInfo("id")||"",mobile_phone:"",note1:""}),u=k({servedPersonsList:[],refCreateServedPersonPopupShown:!1,selectedServedPerson:{}}),f=async()=>{if(l.real_name&&l.mobile_phone){const e=await j.saveServedPerson(l);console.log("=====99==",e),e&&"ok"===e.option&&(uni.$u.toast("操作成功"),u.refCreateServedPersonPopupShown=!1,v())}else uni.$u.toast("请填写必要信息")},v=async()=>{const e=await j.loadServedPersonsList();u.servedPersonsList=e||[]},L=()=>{s("close")},$=e=>{const t=e.detail.value;u.selectedServedPerson=u.servedPersonsList.find((e=>e.id+""==t+""))||{},console.log(u.selectedServedPerson,"====0909==")},M=()=>{s("finishSelect",u.selectedServedPerson)};return b((e=>{v()})),t({}),(e,t)=>{const s=p(m("uni-nav-bar"),H),g=p(m("uni-icons"),V),k=x,b=D,Y=I,A=p(m("u-input"),X),B=p(m("u-form-item"),U),z=p(m("u-form"),q),N=d;return a(),i(N,null,{default:o((()=>[c("    请选择预约人"),h(Z,{class:"served-persons-list-wrap",ref_key:"refPopupModal",ref:n},{content:o((()=>[y("div",{class:"pop-content-wrap"},[h(s,{"status-bar":"","left-icon":"left",title:"选择预约人",onClickLeft:L}),y("div",{class:"served-persons-list"},[h(b,{class:"list-table",onChange:$},{default:o((()=>[(a(!0),_(C,null,P(u.servedPersonsList,((e,t)=>(a(),_("div",{class:"person-item",key:t},[y("div",{class:"item-cell"},[h(g,{onClick:t=>{return s=e,Object.assign(l,s),void(u.refCreateServedPersonPopupShown=!0);var s},title:"修改",type:"compose",size:"18"},null,8,["onClick"]),h(g,{onClick:t=>(async e=>{if((await T({title:"温馨提示",content:"确认删除？"})).confirm){const t=await j.deleteServedPerson(e);t&&"ok"===t.option&&(uni.$u.toast("操作成功"),v())}})(e),style:{"margin-left":"15px"},title:"删除",type:"trash-filled",size:"18"},null,8,["onClick"])]),y("div",{class:"item-cell person-info"},[y("div",null,[y("span",{style:{"font-size":"18px","font-weight":"bold"}},S(e.real_name),1),c('                  <span style="color: gray;"> | {{item.mobile_phone}}</span>')]),y("div",null,"手机 "+S(e.mobile_phone),1),y("div",{style:{color:"lightgray"}},"备注 "+S(e.note1),1)]),y("div",{class:"item-cell"},[w("选择 "),h(k,{value:e.id,checked:e.id+""==u.selectedServedPerson.id+""},null,8,["value","checked"])])])))),128))])),_:1})]),y("div",{class:"bottom-buttons"},[h(Y,{class:"mini-btn",type:"default",onClick:t[0]||(t[0]=e=>u.refCreateServedPersonPopupShown=!0)},{default:o((()=>[w("+ 添加预约人")])),_:1}),h(Y,{class:"mini-btn",type:"primary",onClick:M},{default:o((()=>[w("完成")])),_:1})])])])),_:1},512),c("    添加择预约人"),c("    新增预约人 popup"),u.refCreateServedPersonPopupShown?(a(),i(Z,{key:0,class:"create-served-person-popup-wrap",ref:"refCreatePopupModal"},{content:o((()=>[y("div",{class:"content-wrap"},[h(s,{"status-bar":"","left-icon":"left",title:"新增预约人",onClickLeft:t[1]||(t[1]=e=>u.refCreateServedPersonPopupShown=!1)}),h(z,{ref:"formRef",model:l,"label-width":"90px",rules:r,class:"new-add-served-person-form"},{default:o((()=>[h(B,{label:"名字",name:"real_name",required:""},{default:o((()=>[h(A,{modelValue:l.real_name,"onUpdate:modelValue":t[2]||(t[2]=e=>l.real_name=e),clearable:"",placeholder:"请输入预约人名字"},null,8,["modelValue"])])),_:1}),h(B,{label:"手机",prop:"mobile_phone",required:""},{default:o((()=>[h(A,{modelValue:l.mobile_phone,"onUpdate:modelValue":t[3]||(t[3]=e=>l.mobile_phone=e),clearable:"",placeholder:"请输入预约人手机号"},null,8,["modelValue"])])),_:1}),h(B,{label:"备注",prop:"note1"},{default:o((()=>[h(A,{modelValue:l.note1,"onUpdate:modelValue":t[4]||(t[4]=e=>l.note1=e),clearable:"",placeholder:"请输入备注"},null,8,["modelValue"])])),_:1}),y("div",null,[h(Y,{class:"mini-btn",type:"primary",onClick:f},{default:o((()=>[w("保存")])),_:1})])])),_:1},8,["model","rules"])])])),_:1},512)):c("v-if",!0)])),_:1})}}}),[["__scopeId","data-v-69f016b3"]]),ie=O(v({__name:"booking_confirm",props:{service_schedule_setting_id:{default:""},servicePersonId:{default:""},service_time:{default:""},selectedDate:{default:""},section:{default:"am"}},emits:["pickOneServiceStamp"],setup(e,{expose:t,emit:s}){const n=e;g(null);const r=j.pagesParameterBridge("pickStampToConfirmPage",{},"get")||{};g(null);const l=k({dataLoaded:!1,pickDate:"",activeTabCode:n.section||"am",datesList:[],personData:{},sectionTabItems:[],service_schedule_setting_id:r.service_schedule_setting_id||"",servicePersonId:r.servicePersonId||"",service_time:r.service_time||"",servedPersonsList:[],servedPersonManageShown:!1,selectedServedPerson:{},comment:"",storeInfo:{address:W.getAppInfo("store.address")}}),{days:u,startDate:f,endDate:v}=j.loopDates();l.datesList=u;const P=async()=>{const e={service_schedule_setting_id:l.service_schedule_setting_id,booking_user_id:z.getUserInfo("id"),service_person_id:l.servicePersonId,served_person_id:l.selectedServedPerson.id,service_time:l.service_time,comment:l.comment};if(!e.served_person_id)return uni.$u.toast("请选择预约人"),!1;const t=await j.saveBooking(e);t&&"ok"===t.option&&(L({url:"/pages/booking/booking_order"}),uni.$u.toast("预约成功"))},D=(e,t="YYYY-MM-DD HH:mm")=>B(e).format(t),T=()=>{l.servedPersonManageShown=!0},x=e=>{l.selectedServedPerson=e||{},l.servedPersonManageShown=!1};return b((e=>{(async()=>{l.dataLoaded=!1;let e=n.selectedDate;n.selectedDate+""===B().format("YYYY-MM-DD")&&(e="");const t=await j.getAvailableServicePersonsList(-1,e,r.servicePersonId)||{};t.servicePerson&&(l.personData=t.servicePerson),l.dataLoaded=!0})()})),t({}),(e,t)=>{const s=p(m("uni-icons"),V),n=p(m("u-avatar"),E),r=p(m("u-input"),X),u=I,f=d;return a(),i(f,null,{default:o((()=>{return[y("div",{class:"section-service-person rounded-box1"},[y("div",{class:"service-time-wrap"},[y("div",null,[h(s,{type:"calendar",size:"18"})]),y("div",{class:"service-date-time"},S(D(l.service_time)),1),y("div",{class:"weekday-name"},"星期"+S((e=l.service_time,j.chineseWeekday(B(e).format("d")))),1)]),y("div",{class:"service-address-wrap flex"},[y("div",null,[h(s,{type:"location",size:"18"})]),y("div",{class:"service-address"},S(l.storeInfo.address),1)]),y("div",{class:"person-intro-info flex"},[y("div",{class:"person-avatar"},[h(n,{src:l.personData.avatar||"/static/images/user/default_avatar.png",size:130},null,8,["src"])]),y("div",{class:"person-name"},S(l.personData.name),1)])]),c("    接受服务的人"),y("div",{class:"section-served-person rounded-box1"},[y("div",{class:"served-person-line s-underline"},[y("div",{class:"column1"},[w("预约人"),y("span",{style:{color:"red"}},"*")]),y("div",{class:"select-field"},[y("div",{class:"line-value-field",onClick:T},[l.selectedServedPerson.id?(a(),_(C,{key:0},[w(S(l.selectedServedPerson.real_name),1)],64)):(a(),_(C,{key:1},[w("请选择")],64))]),y("div",null,[h(s,{type:"right",size:"18"})])])]),y("div",{class:"served-person-line"},[y("div",{class:"column1"},"手机号"),y("div",{class:"line-value-field"},[l.selectedServedPerson.id?(a(),_(C,{key:0},[w(S(l.selectedServedPerson.mobile_phone),1)],64)):c("v-if",!0)]),y("div")]),y("div",{class:"served-person-line"},[y("div",{class:"column1"},"备注"),y("div",{class:"line-value-field"},[h(r,{modelValue:l.comment,"onUpdate:modelValue":t[0]||(t[0]=e=>l.comment=e),clearable:"",placeholder:"请输入备注信息"},null,8,["modelValue"])]),y("div")])]),c("    费用相关"),y("div",{class:"section-fees rounded-box1"},[y("div",{class:"service-fee flex"},[y("div",null,"费用"),y("div",{class:"fee-value"},"￥0（免费）")]),y("div",{class:"pay-method"},[y("div",null,"支付方式"),y("div",{class:"value-field"},"现场支付")])]),c("    提示信息"),y("div",{class:"section-messages"},[y("div",null,"重要提示："),y("div",null,"1. 若要取消预约请提前1天告知我们"),y("div",null,"2. 本次预约当天不可以取消")]),y("div",{class:"bottom-buttons"},[h(u,{class:"mini-btn",type:"primary",onClick:P},{default:o((()=>[w("确定预约")])),_:1})]),c("    请选择预约人"),l.servedPersonManageShown?(a(),i(ae,{key:0,onClose:t[1]||(t[1]=e=>{l.servedPersonManageShown=!1}),onFinishSelect:x})):c("v-if",!0)];var e})),_:1})}}}),[["__scopeId","data-v-7f22f73f"]]),oe=O(v({__name:"booking_detail",setup(e){const t=$(),s=$(),n=k({servicePersonId:"",navPage:{current:"selectStamp"}}),r=M((()=>"selectStamp"===n.navPage.current?"预约服务":"确认预约")),l=()=>{"stampConfirm"===n.navPage.current?n.navPage.current="selectStamp":L({url:"/pages/booking/booking"})},u=()=>{n.navPage.current="stampConfirm"};return n.servicePersonId=F().personId||"",b((e=>{})),Y((()=>{})),(e,f)=>{const v=p(m("uni-nav-bar"),H),g=p(m("tabbar"),N),k=d;return a(),i(k,{class:"page-container"},{default:o((()=>[h(v,{fixed:!0,"status-bar":"","left-icon":"left",title:A(r),onClickLeft:l},null,8,["title"]),c(" 先选择时间 "),"selectStamp"===n.navPage.current?(a(),i(se,{key:0,ref_key:"refBookingPerson",ref:t,servicePersonId:n.servicePersonId,onPickStampToConfirmPage:u},null,8,["servicePersonId"])):c("v-if",!0),c(" 预约确认页面 "),"stampConfirm"===n.navPage.current?(a(),i(ie,{key:1,ref_key:"refBookingConfirm",ref:s,servicePersonId:n.servicePersonId},null,8,["servicePersonId"])):c("v-if",!0),h(g)])),_:1})}}}),[["__scopeId","data-v-3afe9e2b"]]);export{oe as default};

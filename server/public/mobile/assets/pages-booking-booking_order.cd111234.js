import{o as e,c as s,w as a,l as t,t as r,s as i,v as o,h as n,A as d,d as l,m as c,b as u,n as p,r as v,a as m,k as g,aI as f,B as _,aJ as k,e as y,f as b,F as x,p as w}from"./index.11096ec6.js";import{d as h,b as I,_ as z,a as S}from"./bookingDatesService.4a915d23.js";import{_ as j}from"./u-avatar.1007c5ff.js";import{_ as P}from"./_plugin-vue_export-helper.cdc0426e.js";import{_ as D}from"./z-paging.b0815311.js";import{_ as C}from"./tabbar.vue_vue_type_script_setup_true_lang.c61322ac.js";import{a as O}from"./appService.129bd686.js";import{P as Y}from"./popup-modal.8582d6e1.js";import{l as B}from"./lodash.default.25203653.js";import"./u-icon.5ed808e6.js";import"./util.9e38efcf.js";const M=P({name:"UniTag",emits:["click"],props:{type:{type:String,default:"default"},size:{type:String,default:"normal"},text:{type:String,default:""},disabled:{type:[Boolean,String],default:!1},inverted:{type:[Boolean,String],default:!1},circle:{type:[Boolean,String],default:!1},mark:{type:[Boolean,String],default:!1},customStyle:{type:String,default:""}},computed:{classes(){const{type:e,disabled:s,inverted:a,circle:t,mark:r,size:i,isTrue:o}=this;return["uni-tag--"+e,"uni-tag--"+i,o(s)?"uni-tag--disabled":"",o(a)?"uni-tag--"+e+"--inverted":"",o(t)?"uni-tag--circle":"",o(r)?"uni-tag--mark":"",o(a)?"uni-tag--inverted uni-tag-text--"+e:"","small"===i?"uni-tag-text--small":""].join(" ")}},methods:{isTrue:e=>!0===e||"true"===e,onClick(){this.isTrue(this.disabled)||this.$emit("click")}}},[["render",function(l,c,u,p,v,m){const g=d;return u.text?(e(),s(g,{key:0,class:i(["uni-tag",m.classes]),style:o(u.customStyle),onClick:m.onClick},{default:a((()=>[t(r(u.text),1)])),_:1},8,["class","style","onClick"])):n("v-if",!0)}],["__scopeId","data-v-9ce1c503"]]),A=P(l({__name:"booking_order_detail",props:{bookingOrder:{default:{}}},emits:["close"],setup(o,{emit:n}){const d=o,l=c({orderItem:{}}),f=()=>{n("close")},_=(e,s="YYYY-MM-DD HH:mm")=>h(e).format(s);return(async()=>{const e=await I.loadBookingOrderDetails(d.bookingOrder.id);l.orderItem=e||{}})(),(o,n)=>{const d=v(m("uni-nav-bar"),z),c=v(m("uni-icons"),S),k=v(m("u-avatar"),j),y=v(m("uni-tag"),M),b=g;return e(),s(b,{class:"page-container"},{default:a((()=>{return[u(d,{fixed:!0,"status-bar":"","left-icon":"left",title:"预约订单详情",onClickLeft:f}),p("div",{class:"booking-success-wrap"},[p("div",{class:"success-icon"},[u(c,{type:"checkbox-filled",size:"60",color:"#007aff"})]),p("div",{class:"success-text"},"预约成功")]),p("div",{class:i([l.orderItem.booking_status,"rounded-box1"])},[p("div",{class:"service-person-wrap"},[p("div",{class:"person-avatar"},[u(k,{src:l.orderItem.servicePersonAvatar||"/static/images/user/default_avatar.png",size:130},null,8,["src"])]),p("div",{class:"person-name"},[t(r(l.orderItem.servicePersonName)+" ",1),p("div",{class:"order-status"},["confirmed"===l.orderItem.booking_status?(e(),s(y,{key:0,text:"已完成",type:"warning"})):(e(),s(y,{key:1,text:"待完成",type:"success"}))])])]),p("div",{class:"served-person-wrap"},[p("div",{class:"served-person"},[u(c,{type:"auth",size:"18"}),t(" 预约人: "+r(l.orderItem.servedPersonName),1)]),p("div",{class:"service-time-wrap"},[p("div",null,[u(c,{type:"calendar",size:"18"}),t(" 服务时间： ")]),p("div",{class:"service-date-time"},r(_(l.orderItem.service_time)),1),p("div",{class:"weekday-name"},"星期"+r((o=l.orderItem.service_time,I.chineseWeekday(h(o).format("d")))),1)]),p("div",{class:"service-address-wrap flex"},[p("div",null,[u(c,{type:"location",size:"18"}),t(" 服务地址：")]),p("div",{class:"service-address"},r((a="address",O.getAppInfo(`store.${a}`))),1)]),p("div",{class:"created-at"},[t(" 下单时间："+r(l.orderItem.created_at)+", 订单号：",1),p("strong",null,r(l.orderItem.id),1)])])],2)];var a,o})),_:1})}}}),[["__scopeId","data-v-9bba7503"]]),H=P(l({__name:"booking_order",setup(o){const d=f(null),l=_([]),P=c({showDetailPopup:!1,currentOrder:{}}),H=()=>{w({url:"/pages/user/user"})};let T={},N={};const V=async(e,s)=>{try{const a=await I.loadBookings({pageNo:e,pageSize:s});(B.get(a,"extend.servicePersons")||[]).map((e=>{T[e.id]=e})),(B.get(a,"extend.servedPersons")||[]).map((e=>{N[e.id]=e})),d.value.complete(a.lists||[])}catch(a){console.log("报错=>",a),d.value.complete(!1)}},$=(e,s="")=>{const a=B.get(T,B.get(e,"service_person_id"))||{};return B.get(a,s,a)},L=(e,s="")=>{const a=B.get(N,B.get(e,"served_person_id"))||{};return B.get(a,s,a)},U=(e,s="YYYY-MM-DD HH:mm")=>h(e).format(s);return k((e=>{})),(o,c)=>{const f=v(m("uni-nav-bar"),z),_=v(m("u-avatar"),j),k=v(m("uni-tag"),M),w=v(m("uni-icons"),S),B=v(m("z-paging"),D),T=v(m("tabbar"),C),N=g;return e(),s(N,{class:"page-container"},{default:a((()=>[u(f,{fixed:!0,"status-bar":"","left-icon":"left",title:"全部预约",onClickLeft:H}),n("v-if",!0),p("div",{class:"booking-orders-wrap"},[u(B,{"auto-show-back-to-top":"",ref_key:"paging",ref:d,modelValue:l.value,"onUpdate:modelValue":c[0]||(c[0]=e=>l.value=e),onQuery:V,fixed:!1,height:"100%"},{default:a((()=>[(e(!0),y(x,null,b(l.value,((a,o)=>{return e(),y("div",{key:o,class:i([a.booking_status,"rounded-box1"]),onClick:e=>{return s=a,P.currentOrder=s,void(P.showDetailPopup=!0);var s}},[p("div",{class:"service-person-wrap"},[p("div",{class:"person-avatar"},[u(_,{src:$(a,"avatar")||"/static/images/user/default_avatar.png",size:130},null,8,["src"])]),p("div",{class:"person-name"},[t(r($(a,"name"))+" ",1),p("div",{class:"order-status"},["confirmed"===a.booking_status?(e(),s(k,{key:0,text:"已完成",type:"warning"})):(e(),s(k,{key:1,text:"待完成",type:"success"}))])])]),p("div",{class:"served-person-wrap"},[p("div",{class:"served-person"},[u(w,{type:"auth",size:"18"}),t(" 预约人: "+r(L(a,"real_name")),1)]),p("div",{class:"service-time-wrap"},[p("div",null,[u(w,{type:"calendar",size:"18"}),t(" 服务时间： ")]),p("div",{class:"service-date-time"},r(U(a.service_time)),1),p("div",{class:"weekday-name"},"星期"+r((d=a.service_time,I.chineseWeekday(h(d).format("d")))),1)]),p("div",{class:"service-address-wrap flex"},[p("div",null,[u(w,{type:"location",size:"18"}),t(" 服务地址：")]),p("div",{class:"service-address"},r((n="address",O.getAppInfo(`store.${n}`))),1)]),p("div",{class:"created-at"},[t(" 下单时间："+r(a.created_at)+", 订单号：",1),p("strong",null,r(a.id),1)])])],10,["onClick"]);var n,d})),128))])),_:1},8,["modelValue"])]),u(T),P.showDetailPopup?(e(),s(Y,{key:1,class:"one-order-detail-popup",ref:"refPopupModal"},{content:a((()=>[u(A,{bookingOrder:P.currentOrder,onClose:c[1]||(c[1]=e=>{P.showDetailPopup=!1})},null,8,["bookingOrder"])])),_:1},512)):n("v-if",!0)])),_:1})}}}),[["__scopeId","data-v-e958894d"]]);export{H as default};
